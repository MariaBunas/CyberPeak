<!DOCTYPE html> 
<html> 
<head> 
<title>HartƒÉ InteractivƒÉ</title>
<meta charset="utf-8" />
 <meta name="viewport" content="width=device-width, initial-
scale=1.0">
 
<!-- Leaflet CSS and JS --> 
<link rel="stylesheet" 
href="https://unpkg.com/leaflet/dist/leaflet.css" /> 
<link rel="stylesheet" href="style.css"> 
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script> 

<!-- PapaParse CSV Parser --> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js">
</script>
 
<!-- <script type="text/javascript" src="script.js"></script> -->

<style> 
#map { height: 600px; width: 100%; } 
</style> 
</head> 
<body> 


<h2>üó∫Ô∏è HartƒÉ InteractivƒÉ - Cyberpeak</h2> 
<div id="map"></div> 

<script> 
// icons : 
const icons = { 
ok: L.icon({ 
iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png',
 iconSize: [25, 41],
 iconAnchor: [12, 41],
 popupAnchor: [1, -34],
 shadowUrl: 'https://unpkg.com/leaflet@1.9.3/dist/images/marker-shadow.png', 
shadowSize: [41, 41] }), 
warning: L.icon({ 
iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-yellow.png', 
iconSize: [25, 41], 
iconAnchor: [12, 41], 
popupAnchor: [1, -34], 
shadowUrl: 'https://unpkg.com/leaflet@1.9.3/dist/images/marker-shadow.png', 
shadowSize: [41, 41] }), 
bad: L.icon({ 
iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png', 
iconSize: [25, 41], 
iconAnchor: [12, 41], 
popupAnchor: [1, -34], 
shadowUrl: 'https://unpkg.com/leaflet@1.9.3/dist/images/marker-shadow.png', 
shadowSize: [41, 41] }) }; 

// Initialize the map
 const map = L.map('map').setView([45.76, 21.23], 6);  // Center map as needed 

// Load tile layer (OpenStreetMap) 
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap contributors' }).addTo(map); const legend = L.control({ position: 'bottomright' }); 

legend.onAdd = function (map) { 
const div = L.DomUtil.create('div', 'info-legend'); 
div.innerHTML = `
 <strong>Severity</strong><br> 
<div class="legend-item"><span class="dot red"></span> 
Bad</div> 
<div class="legend-item"><span class="dot yellow"></span> 
Pretty Bad</div> <div class="legend-item"><span class="dot green"></span> 
OK</div> 
`; 
return div; 
}; 
legend.addTo(map);

// üìå Citim loca»õiile din CSV »ôi adƒÉugƒÉm markerii pe hartƒÉ
// fetch('https://cyberpeak-server.onrender.com/file/locations.csv')
fetch('https://raw.githubusercontent.com/MariaBunas/Cyberpeak-Backend/refs/heads/main/locations.csv')
 .then(response => response.text())
 .then(csvText => {
     Papa.parse(csvText, {
         header: true,
         skipEmptyLines: true,
         complete: function(results) {
             results.data.forEach(row => {
                 const lat = parseFloat(row.latitude);
                 const lng = parseFloat(row.longitude);
                 const name = row.name || 'Unnamed Location';
                 const severity = (row.severity || '').toLowerCase();
                 const icon = icons[severity] || icons['ok']; 
                 // const imageUrl = `https://cyberpeak-server.onrender.com/${row.image}`;
                 // const imageUrl = `https://cyberpeak-server.onrender.com/uploads/${row.image}`;
                 const imageUrl = 'c';

                 if (!isNaN(lat) && !isNaN(lng)) {
                     const marker = L.marker([lat, lng], { icon : icon}).addTo(map)
                         .bindPopup(`
                             <strong>${name}</strong><br>
                             Severitate: ${severity} <br>
                             <img src="${imageUrl}" alt="Imagine loca»õie" width="200px">
                         `);
                 }
             });
         }
     });
 })
 .catch(error => console.error("Eroare la citirea loca»õiilor:", error));
 
</script> 

</body> 
</html>

